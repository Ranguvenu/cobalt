{"version":3,"sources":["../src/upload.js"],"names":["define","$","Str","ModalFactory","ModalEvents","Fragment","Ajax","upload","args","contextid","self","init","prototype","get_string","then","title","create","type","types","DEFAULT","body","getBody","footer","getFooter","bind","modal","setLarge","getRoot","on","hidden","animate","setTimeout","destroy","find","submitForm","hide","window","location","reload","form","submitFormAjax","show","formdata","jsonformdata","JSON","stringify","loadFragment","$footer","handleFormSubmissionFailure","data","setBody","e","preventDefault","formData","serialize","params","promise","call","methodname","done","fail","submit"],"mappings":"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","sourcesContent":["/**\n * Streaming video js\n *\n * @module     block_stream/stream\n * @class      stream\n * @package    block_stream\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core/str', 'core/modal_factory', 'core/modal_events', 'core/fragment', 'core/ajax', 'core/yui'],\n        function($, Str, ModalFactory, ModalEvents, Fragment, Ajax, Y) {\n    var upload = function(args) {\n        this.contextid = 1;\n        var self = this;\n        this.args = args;\n        self.init(args);\n    };\n    upload.prototype.init = function(args) {\n        var self = this;\n        return Str.get_string('uploadvideo', 'block_stream').then(function(title) {\n                // Create the modal.\n                return ModalFactory.create({\n                type: ModalFactory.types.DEFAULT,\n                title: title,\n                body: this.getBody(),\n                footer: this.getFooter(),\n                });\n            }.bind(this)).then(function(modal) {\n                // Keep a reference to the modal.\n                this.modal = modal;\n                this.modal.setLarge();\n\n\n                this.modal.getRoot().on(ModalEvents.hidden, function() {\n                    this.modal.getRoot().animate({\"right\":\"-85%\"}, 500);\n                    setTimeout(function(){\n                        modal.destroy();\n                    }, 500);\n                }.bind(this));\n\n                this.modal.getFooter().find('[data-action=\"save\"]').on('click', this.submitForm.bind(this));\n                // We also catch the form submit event and use it to submit the form with ajax.\n\n                this.modal.getFooter().find('[data-action=\"cancel\"]').on('click', function() {\n                    modal.hide();\n                    setTimeout(function(){\n                        modal.destroy();\n                    }, 500);\n                    window.location.reload();\n                    // modal.destroy();\n                });\n\n                this.modal.getRoot().on('submit', 'form', function(form) {\n                    self.submitFormAjax(form, self.args);\n                });\n                this.modal.show();\n\n                return this.modal;\n            }.bind(this));\n    };\n    upload.prototype.getBody = function(formdata) {\n        if (typeof formdata === \"undefined\") {\n            formdata = {};\n        }\n        this.args.jsonformdata = JSON.stringify(formdata);\n        return Fragment.loadFragment('block_stream', 'upload_video', this.contextid, this.args);\n    };\n    upload.prototype.getFooter = function() {\n        $footer = '<button type=\"button\" class=\"btn btn-primary\" data-action=\"save\">Save & Continue</button>&nbsp;';\n        $footer += '<button type=\"button\" class=\"btn btn-secondary\" data-action=\"cancel\">Cancel</button>';\n        return $footer;\n    };\n    upload.prototype.handleFormSubmissionFailure = function(data) {\n        // Oh noes! Epic fail :(\n        // Ah wait - this is normal. We need to re-display the form with errors!\n        this.modal.setBody(this.getBody(data));\n    };\n    upload.prototype.submitFormAjax = function(e ,args) {\n        // We don't want to do a real form submission.\n        e.preventDefault();\n        var self = this;\n        // Convert all the form elements values to a serialised string.\n        var formData = this.modal.getRoot().find('form').serialize();\n        // var methodname = args.plugintype + '_' + args.pluginname + '_submit_create_user_form';\n        var methodname = 'block_stream_upload_video';\n        var params = {};\n        params.contextid = this.contextid;\n        params.jsonformdata = JSON.stringify(formData);\n        var promise = Ajax.call([{\n            methodname: methodname,\n            args: params\n        }]);\n\n         promise[0].done(function(resp){\n            self.modal.hide();\n            window.location.reload();\n        }).fail(function(ex){\n            self.handleFormSubmissionFailure(formData);\n        });\n    };\n    upload.prototype.submitForm = function(e) {\n        e.preventDefault();\n        var self = this;\n        self.modal.getRoot().find('form').submit();\n    };\n    return {\n        init: function(args) {\n            return new upload(args);\n        }\n    }\n});"],"file":"upload.min.js"}