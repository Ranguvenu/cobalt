define ("block_stream/streamcontent",["jquery","core/notification","core/templates","core/paged_content_factory","core/str","block_stream/stream_repository","block_stream/renderstream","core/custom_interaction_events"],function(a,b,c,d,e,f,g,h){var i,j,k,l,m,n,o={EMPTY_MESSAGE:"[data-region=\"empty-message\"]",ROOT:"[data-region=\"stream-list-container\"]",STREAM_LIST_CONTENT:"[data-region=\"stream-list-content\"]",STREAM_LIST_LOADING_PLACEHOLDER:"[data-region=\"stream-list-loading-placeholder\"]",FILTERS:"[data-region=\"filter\"]",FILTER_OPTION:"[data-filter]",SEARCH_QUERY:"[data-filter=\"searchfilter\"]"},p={STREAM_LIST_CONTENT:"block_stream/video-list-item"},q={pagingbar:!0,ignoreControlWhileLoading:!0,controlPlacementBottom:!0,ariaLabels:{itemsperpagecomponents:"ariaeventlistpagelimit, block_timeline"}},r=function(a){a.find(o.STREAM_LIST_CONTENT).addClass("hidden");a.find(o.EMPTY_MESSAGE).removeClass("hidden")},s=function(a){a.find(o.STREAM_LIST_CONTENT).removeClass("hidden");a.find(o.EMPTY_MESSAGE).addClass("hidden")},t=function(a){a.find(o.STREAM_LIST_CONTENT).empty()},u=function(){return{pagingbar:!0,pagingdropdown:!0,skipjs:!0,ignorecontrolwhileloading:!0,controlplacementbottom:!1}},v=function(a){var b=u();b.videos=[];a.forEach(function(a){b.videos.push(a)});return b},w=function(a){var b=v(a);b.itemsperpage=10;var d=p.STREAM_LIST_CONTENT;return c.render(d,b)},x=function(a,b,c,d,e){return f.uploadedVideos({statusfilter:e,sort:l,limit:a,search:m,offset:b})},y=function(){k=a(o.ROOT).attr("data-statusfilter");m=a(o.ROOT).attr("data-searchquery");var b={statusfilter:k,search:m,limit:10,offset:j};return f.updatePreferences(b)},z=function(a,b,c,d,e,f,g){var h=a.pageNumber,i=a.limit,j=h,f=(h-1)*g;while(!c.hasOwnProperty(j)){j--}var k=c[j],l=null;if(d&&d.hasOwnProperty(h)){l=d[h]}else{l=x(i+1,f,g,k,e)}return l.then(function(a){if(!a.length){b.allItemsLoaded(h);return[]}var c=a.data;n=c.length;return c})},A=function(c,f,g,h,i,j,k,l){var m={1:0},n=!1,o=a.extend({},q,l);return e.get_string("ariaeventlistpagelimit","block_timeline",a.isArray(f)?f[0].value:f).then(function(a){o.ariaLabels.itemsperpage=a;o.ariaLabels.paginationnav=k;return a}).then(function(){return d.createWithTotalAndLimit(c,f,function(c,d){var e=[];c.forEach(function(a){var c=a.pageNumber,h=z(a,d,m,g,i,j,f).then(function(a){if(a.length){n=!0;return w(a)}else{return a}}).catch(b.exception);e.push(h)});a.when.apply(a,e).then(function(){h.resolve(n)}).catch(function(){h.resolve(n)});return e},o)})},B=function(d){var e=1<arguments.length&&arguments[1]!==void 0?arguments[1]:5,f=2<arguments.length?arguments[2]:void 0,g=3<arguments.length?arguments[3]:void 0,h=4<arguments.length?arguments[4]:void 0;if("undefined"!=typeof d){d=a(d)}else{d=a(o.ROOT)}var n=a.Deferred(),p=d.find(o.STREAM_LIST_CONTENT),q=d.find(o.STREAM_LIST_LOADING_PLACEHOLDER);i=d.attr("data-length");j=d.attr("data-videosOffset");k=d.attr("data-statusfilter");l=d.attr("data-sortfilter");m=d.attr("data-searchquery");t(d);s(d);q.removeClass("hidden");return A(i,e,f,n,k,j,g,h).then(function(b,e){b=a(b);b.addClass("hidden");c.replaceNodeContents(p,b,e);n.then(function(a){b.removeClass("hidden");q.addClass("hidden");if(!a){r(d)}return a}).catch(function(){return!1});return b}).catch(b.exception)};return{init:B,rootSelector:o.ROOT,registerSelector:function registerSelector(b){if("undefined"!=typeof b){b=a(b)}else{b=a(o.ROOT)}var c=b.find(o.FILTERS),d=b.find(o.SEARCH_QUERY);h.define(c,[h.events.activate]);a("#id_search").on("click",function(){var c=a(d).val();b.attr("data-searchquery",c);var e=y();e.then(function(a){console.log(a);b.attr("data-length",a.length);B()})});c.on(h.events.activate,o.FILTER_OPTION,function(c,d){var e=a(c.target),f=e.attr("data-filter"),g=e.attr("data-pref");b.attr("data-"+f,e.attr("data-value"));var h=y();h.then(function(a){b.attr("data-length",a.length);B()});d.originalEvent.preventDefault()})}}});
//# sourceMappingURL=streamcontent.min.js.map
