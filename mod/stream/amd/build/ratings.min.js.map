{"version":3,"sources":["../src/ratings.js"],"names":["define","Ajax","Str","templates","$","ratePicker","target","options","self","max","rgbOn","spaceWidth","fontsize","rgbOff","rgbSelection","cursor","indicator","stars","data","css","append","type","name","replace","value","class","style","i","icon","set_target_width","each","index","item","click","val","rate","set_user_ratings","mouseover","mouseleave","prototype","item_width","width","promise","call","methodname","args","componentid","itemid","ratingvalue","done","resp","html","init","JSON","parse","updatevalues","params","likestatus","addClass","removeClass","dislike","like","hide","trigger","document","ready","content","ratearea","contextid","render","then","hover","find","load"],"mappings":"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","sourcesContent":["/**\n * Add a create new group modal to the page.\n *\n * @module     mod/stream\n * @class      Ratings\n * @package    stream\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['core/ajax', 'core/str','core/templates', 'jquery', 'jqueryui'],\n        function(Ajax, Str, templates, $) {\n    var ratePicker = function (target, options){\n        var self = this;\n        if (typeof options === 'undefined'){\n            options = {};\n        }\n        options.max = typeof options.max === 'undefined' ? 5 : options.max;\n        options.rgbOn = typeof options.rgbOn === 'undefined' ? \"#f1c40f\" : options.rgbOn;\n        options.spaceWidth = typeof options.spaceWidth === 'undefined' ? '1px' : options.spaceWidth;\n        options.fontsize = typeof options.fontsize === 'undefined' ? '25px' : options.fontsize;\n        options.rgbOff = typeof options.rgbOff === 'undefined' ? \"#ecf0f1\" : options.rgbOff;\n        options.rgbSelection = typeof options.rgbSelection === 'undefined' ? \"#ffcf10\" : options.rgbSelection;\n        options.cursor = typeof options.cursor === 'undefined' ? \"pointer\" : options.cursor;\n        options.indicator = typeof options.indicator === 'undefined' ? \"fa fa-star\" : \"fa \"+options.indicator;\n        var stars = typeof $(target).data('stars') == 'undefined' ? 0 : $(target).data('stars');\n\n        $(target).css('cursor', options.cursor);\n        $(target).append($(\"<input>\", {type : \"hidden\", name : target.replace(\"#\", \"\"), value : stars}));\n\n        $(target).append($(\"<i>\", {class : options.indicator, style : \"display:none; font-size: \"+options.fontsize+\"; color: transparent;\"}));\n        for (var i = 1; i <= options.max; i++){\n            var icon = $(\"<i>\", {class : options.indicator, style : \"font-size: \"+options.fontsize+\"; margin-left: \"+options.spaceWidth+\"; color:\" + (i <= stars ? options.rgbOn : options.rgbOff)});\n            $(target).append(icon);\n\n        }\n        self.set_target_width(target, options);\n        $(target).append($(\"<i>\", {class : options.indicator, style : \"display:none; font-size: \"+options.fontsize+\"; color: transparent;\"}));\n        $.each($(target + \" > i\"), function (index, item){\n            $(item).click(function (){\n                $(\"[name=\" + target.replace(\"#\", \"\") + \"]\").val(index);\n                for (var i = 1; i <= options.max; i++){\n                    $($(target + \"> i\")[i]).css(\"color\", i <= index ? options.rgbOn : options.rgbOff);\n                }\n                if (!(options.rate === 'undefined')){\n                    stars = index;\n                    self.set_user_ratings(target, index);\n                }\n            });\n            $(item).mouseover(function (){\n                for (var i = 1; i <= options.max; i++){\n                    $($(target + \" > i\")[i]).css(\"color\", i <= index ? options.rgbSelection : options.rgbOff);\n                }\n            });\n            $(item).mouseleave(function(){\n                $(\"[name=\" + target.replace(\"#\", \"\") + \"]\").val(index);\n                for (var i = 1; i <= options.max; i++){\n                    $($(target + \"> i\")[i]).css(\"color\", i <= stars ? options.rgbOn : options.rgbOff);\n                }\n            });\n        });\n    };\n    ratePicker.prototype.set_target_width = function(target, options){\n        var indicator = options.indicator.replace(/\\ /g, '.');\n        var spaceWidth = options.spaceWidth;\n        var item_width = $('.'+indicator).width();\n        $(target).width(((item_width+spaceWidth) * (options.max+1))+'px');\n    };\n    ratePicker.prototype.set_user_ratings = function(target, stars){\n        var data = $(target).data();\n        var promise = Ajax.call([{\n            methodname: 'mod_stream_submit_rating',\n            args: { componentid : data.itemid,  ratingvalue : stars }\n        }]);\n        promise[0].done(function(resp) {\n            self.html(resp);\n        });\n    }\n    return {\n        init : function(target, options){\n            options = JSON.parse(options);\n            return new ratePicker(target, options);\n            \n        },\n        updatevalues: function (params){\n            var promise = Ajax.call([{\n                        methodname: 'mod_stream_like_dislike',\n                        args: params\n                    }]);\n                    promise[0].done(function(resp) {\n                    if (params.likestatus == 2) {\n                        $(\".fa-thumbs-down\").addClass('active');\n                        $(\".fa-thumbs-up\").removeClass('active');\n                    }else{\n                        $(\".fa-thumbs-up\").addClass('active');\n                        $(\".fa-thumbs-down\").removeClass('active');\n                    }\n                    $(\".count_unlikearea_\"+params.componentid).html(resp.dislike);\n                    $(\".count_likearea_\"+params.componentid).html(resp.like);\n                    $(\"#loading_image\").hide();\n                    });\n        },\n        trigger: function(){\n            $(document).ready(function(){\n                var content = $('#ratingList').html();\n                if(content == ''){\n                    $('#ratingList').html(' ');\n                    var self = $('#ratingList');\n                    var data = $('#ratingList').data();\n                    var params = {};\n                    params.itemid = data.itemid;\n                    params.ratearea = data.ratearea;\n                    params.contextid = 1;\n\n                    var promise = Ajax.call([{\n                        methodname: 'mod_stream_ratings_get_ratings_info',\n                        args: params\n                    }]);\n                    promise[0].done(function(resp) {\n                        templates.render('mod_stream/detailed_info_loaded', resp).then(function(html,js) {\n                            self.html(html);\n                        });\n                    });\n                }\n            });\n            $('.overall_users.mt-10').hover(function(){\n                var content = $(this).find('.rating_tooltip').html();\n                if(content == ''){\n                    $(this).find('.rating_tooltip').html(' ');\n                    var self = $(this).find('.rating_tooltip');\n                    var data = $(this).find('.rating_tooltip').data();\n                    var params = {};\n                    params.itemid = data.itemid;\n                    params.ratearea = data.ratearea;\n                    params.contextid = 1;\n\n                    var promise = Ajax.call([{\n                        methodname: 'mod_stream_ratings_get_ratings_info',\n                        args: params\n                    }]);\n                    promise[0].done(function(resp) {\n                        templates.render('mod_stream/detailed_info', resp).then(function(html,js) {\n                            self.html(html);\n                        });\n                    });\n                }\n            });\n        },\n        load: function(){\n\n        }\n    }\n});"],"file":"ratings.min.js"}